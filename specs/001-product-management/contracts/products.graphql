# Product Type Definitions and Operations
# API Version: v1
# Rate Limits: 
#   - Queries: 1000 req/min per user
#   - Mutations: 100-200 req/min per user

"""
Core product entity representing a marketplace item
"""
type Product {
  id: ID!
  title: String!
  handle: String!
  subtitle: String
  description: String
  isGiftcard: Boolean!
  status: ProductStatus!
  thumbnail: String
  weight: String
  length: String
  height: String
  width: String
  originCountry: String
  hsCode: String
  midCode: String
  material: String
  discountable: Boolean!
  externalId: String
  metadata: JSON
  createdAt: DateTime!
  updatedAt: DateTime!
  
  # Relations (resolved via field resolvers)
  collection: ProductCollection
  type: ProductType
  variants: [ProductVariant!]!
  categories: [ProductCategory!]!
  tags: [ProductTag!]!
  options: [ProductOption!]!
  images: [ProductImage!]!
}

"""
Product status enum
"""
enum ProductStatus {
  DRAFT
  PROPOSED
  PUBLISHED
  REJECTED
}

"""
Product connection for pagination
"""
type ProductConnection {
  nodes: [Product!]!
  pageInfo: PageInfo!
  totalCount: Int!
}

"""
Page information for cursor-based pagination
"""
type PageInfo {
  hasNextPage: Boolean!
  hasPreviousPage: Boolean!
  startCursor: String
  endCursor: String
}

"""
Input for creating a new product
"""
input CreateProductInput {
  title: String!
  handle: String
  subtitle: String
  description: String
  isGiftcard: Boolean = false
  status: ProductStatus = DRAFT
  thumbnail: String
  weight: String
  length: String
  height: String
  width: String
  originCountry: String
  hsCode: String
  midCode: String
  material: String
  collectionId: ID
  typeId: ID
  discountable: Boolean = true
  externalId: String
  metadata: JSON
  categoryIds: [ID!]
  tagIds: [ID!]
}

"""
Input for updating an existing product
"""
input UpdateProductInput {
  title: String
  subtitle: String
  description: String
  status: ProductStatus
  thumbnail: String
  weight: String
  length: String
  height: String
  width: String
  originCountry: String
  hsCode: String
  midCode: String
  material: String
  collectionId: ID
  typeId: ID
  discountable: Boolean
  externalId: String
  metadata: JSON
  # Timestamp for optimistic locking
  expectedUpdatedAt: DateTime!
}

"""
Product filter input for list queries
"""
input ProductFilter {
  status: ProductStatus
  collectionId: ID
  typeId: ID
  categoryId: ID
  tagIds: [ID!]
  isGiftcard: Boolean
  discountable: Boolean
  search: String
}

"""
Product sort options
"""
input ProductSort {
  field: ProductSortField!
  direction: SortDirection = ASC
}

enum ProductSortField {
  TITLE
  CREATED_AT
  UPDATED_AT
  STATUS
}

enum SortDirection {
  ASC
  DESC
}

"""
Product mutation response payload
"""
type ProductPayload {
  product: Product
  errors: [Error!]
}

"""
Error type for mutation responses
"""
type Error {
  field: String
  message: String!
  code: String!
}

# Query Examples:

# Get a single product by ID
# query GetProduct {
#   product(id: "prod_123") {
#     id
#     title
#     handle
#     status
#     variants {
#       id
#       title
#       sku
#     }
#     categories {
#       id
#       name
#     }
#   }
# }

# List products with filters
# query ListProducts {
#   products(
#     filter: { status: PUBLISHED, categoryId: "cat_456" }
#     sort: { field: CREATED_AT, direction: DESC }
#     pagination: { limit: 20, offset: 0 }
#   ) {
#     nodes {
#       id
#       title
#       status
#     }
#     pageInfo {
#       hasNextPage
#       totalCount
#     }
#   }
# }

# Mutation Examples:

# Create a new product
# mutation CreateProduct {
#   createProduct(
#     input: {
#       title: "Laptop X1"
#       description: "High-performance laptop"
#       status: DRAFT
#       categoryIds: ["cat_electronics", "cat_laptops"]
#       tagIds: ["tag_new", "tag_featured"]
#     }
#   ) {
#     product {
#       id
#       title
#       handle
#       status
#     }
#     errors {
#       field
#       message
#       code
#     }
#   }
# }

# Update a product
# mutation UpdateProduct {
#   updateProduct(
#     id: "prod_123"
#     input: {
#       status: PUBLISHED
#       expectedUpdatedAt: "2025-11-02T10:00:00Z"
#     }
#   ) {
#     product {
#       id
#       status
#       updatedAt
#     }
#     errors {
#       message
#       code
#     }
#   }
# }

