---
github_number: 46
title: "Infrastructure RabbitMQ (Docker + Exchanges)"
status: synced
type: feature
priority: high
epic: 43
prd: kit
assignees: []
labels: [type:feature, priority:high]
created: 2026-02-10
updated: 2026-02-10
---

## Context
From PRD: kit-microservices (Feature 3)
Priority: P0 — Phase 0 : Préparer le Monolithe
Epic: #43

## Description
Intégration de RabbitMQ dans l'environnement de développement local et définition de la topologie des exchanges.

## User Story
**As a** développeur
**I want to** RabbitMQ disponible localement via Docker Compose
**So that** je puisse développer et tester le provider RabbitMQ de l'EventBus

## Acceptance Criteria

### Docker Compose
- [ ] Service `rabbitmq` ajouté à `docker-compose.dev.yml`
- [ ] Image : `rabbitmq:3-management-alpine`
- [ ] Ports : `5672` (AMQP), `15672` (Management UI)
- [ ] Credentials : configurable via `.env`

### Topologie des exchanges
- [ ] `czo.events` (topic exchange) : exchange principal pour tous les events de domaine
- [ ] `czo.system` (fanout exchange) : events système diffusés à tous les services
- [ ] `czo.dlx` (topic exchange) : Dead Letter Exchange pour les messages échoués

### Configuration
- [ ] `runtimeConfig.czo.rabbitmq.url` : URL de connexion AMQP
- [ ] `runtimeConfig.czo.rabbitmq.exchanges` : noms des exchanges (avec defaults)
- [ ] `runtimeConfig.czo.rabbitmq.prefetchCount` : QoS par consumer (default: 10)
- [ ] Env var mapping : `NITRO_CZO_RABBITMQ_URL`, etc.

### Initialisation
- [ ] Création automatique des exchanges au démarrage du provider RabbitMQ
- [ ] Health check : endpoint `/api/_health/rabbitmq` pour vérifier la connexion

## Dependencies
- Docker (existant)
- amqplib (nouveau, optional peer dependency)

## Related
- PRD: docs/planning/kit/prd-microservices.md
- TRD: docs/planning/kit/trd-microservices.md
- Epic: #43
