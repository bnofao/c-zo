---
github_number: 32
title: "Implement EventEmitter with hookable + BullMQ"
status: synced
type: task
priority: medium
epic: 20
prd: kit
assignees: []
labels: []
created: 2026-02-04
updated: 2026-02-10
---

## Overview

Implement the typed EventEmitter for inter-module communication supporting both synchronous and asynchronous events.

## Parent Epic

- Epic #20: @czo/kit Module

## Source Documents

- **TRD**: docs/planning/kit/trd.md (Section 3.3 Events)

## Technical Details

### Interface

```typescript
interface EventEmitter {
  emit<K extends keyof EventMap>(event: K, payload: EventMap[K]): void
  emitAsync<K extends keyof EventMap>(event: K, payload: EventMap[K], options?: AsyncEventOptions): Promise<void>
  on<K extends keyof EventMap>(event: K, handler: (payload: EventMap[K]) => void): () => void
  once<K extends keyof EventMap>(event: K, handler: (payload: EventMap[K]) => void): () => void
  off<K extends keyof EventMap>(event: K, handler: (payload: EventMap[K]) => void): void
}

interface AsyncEventOptions {
  delay?: number      // ms before processing
  retries?: number    // retry count on failure
  priority?: number   // queue priority (higher = first)
}
```

### Implementation

- Use `hookable` for sync events
- Use BullMQ for async events with Redis backend
- Type safety via module augmentation (`EventMap`)
- Event context includes `eventId`, `timestamp`, `actor`, `correlationId`
- Fallback to sync if queue not configured

## Acceptance Criteria

- [ ] `emit()` dispatches sync events via hookable
- [ ] `emitAsync()` queues events via BullMQ
- [ ] Type-safe event names and payloads via module augmentation
- [ ] Event context automatically populated
- [ ] Graceful fallback when Redis unavailable
- [ ] Unsubscribe via returned function from `on()`

## Dependencies

- hookable package
- bullmq package
- Redis infrastructure
