---
github_number: 34
title: "Implement AppRegistry for third-party app management"
status: synced
type: task
priority: medium
epic: 20
prd: kit
assignees: []
labels: []
created: 2026-02-04
updated: 2026-02-04
---

## Overview

Implement the AppRegistry for managing third-party app installation, configuration, and lifecycle.

## Parent Epic

- Epic #20: @czo/kit Module

## Source Documents

- **TRD**: docs/planning/kit/trd.md (Section 3.5 Apps)

## Technical Details

### AppManifest Schema

```typescript
interface AppManifest {
  id: string
  name: string
  version: string
  description: string
  author: { name: string; email: string; url?: string }
  permissions: Permission[]
  webhooks: WebhookSubscription[]
  extensions?: UIExtension[]
  settingsSchema?: JSONSchema
}

interface Permission {
  resource: string
  actions: ('create' | 'read' | 'update' | 'delete')[]
  scope: 'own' | 'shop' | 'global'
}
```

### AppRegistry Interface

```typescript
interface AppRegistry {
  install(manifestUrl: string, shopId: string): Promise<InstalledApp>
  uninstall(appId: string, shopId: string): Promise<void>
  getInstalled(shopId: string): Promise<InstalledApp[]>
  getApp(appId: string, shopId: string): Promise<InstalledApp | null>
  updateSettings(appId: string, shopId: string, settings: unknown): Promise<void>
}
```

### Implementation

- Fetch and validate manifest from URL
- Validate permissions against user's roles via @czo/auth
- Generate auth token for app
- Store in `installed_apps` table (shop-scoped)

## Acceptance Criteria

- [ ] `install()` fetches manifest and validates permissions
- [ ] Auth token generated for each installation
- [ ] `uninstall()` revokes tokens and removes data
- [ ] `getInstalled()` lists apps for a shop
- [ ] Permission validation via @czo/auth PermissionService
- [ ] Settings validation against manifest schema

## Dependencies

- @czo/auth module (PermissionService)
- Database tables (see migration issue)
