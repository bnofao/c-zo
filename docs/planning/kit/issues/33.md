---
github_number: 33
title: "Implement HookRegistry for operation interception"
status: synced
type: task
priority: medium
epic: 20
prd: kit
assignees: []
labels: []
created: 2026-02-04
updated: 2026-02-10
---

## Overview

Implement the HookRegistry for intercepting operations with before/after/onError hooks.

## Parent Epic

- Epic #20: @czo/kit Module

## Source Documents

- **TRD**: docs/planning/kit/trd.md (Section 3.4 Hooks)

## Technical Details

### Interface

```typescript
interface HookRegistry {
  before<K extends keyof HookMap>(hook: K, handler: (ctx: HookMap[K]['context']) => void | Promise<void>): () => void
  after<K extends keyof HookMap>(hook: K, handler: (ctx: HookMap[K]['context'], result: HookMap[K]['result']) => void | Promise<void>): () => void
  onError<K extends keyof HookMap>(hook: K, handler: (ctx: HookMap[K]['context'], error: Error) => void | Promise<void>): () => void
  run<K extends keyof HookMap>(hook: K, context: HookMap[K]['context'], fn: () => Promise<HookMap[K]['result']>): Promise<HookMap[K]['result']>
}
```

### Implementation

- Built on `hookable` library
- Before hooks can modify context
- After hooks can modify result
- Error hooks for logging/recovery
- Type safety via module augmentation (`HookMap`)

## Acceptance Criteria

- [ ] `before()` hooks execute before operation
- [ ] `after()` hooks execute after operation
- [ ] `onError()` hooks execute on errors
- [ ] `run()` orchestrates hook execution
- [ ] Hooks can modify context/result
- [ ] Type-safe hook names via HookMap augmentation
- [ ] Unsubscribe via returned function

## Dependencies

- hookable package
