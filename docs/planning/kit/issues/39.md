---
github_number: 39
title: "Write unit tests for @czo/kit module"
status: synced
type: task
priority: medium
epic: 20
prd: kit
assignees: []
labels: []
created: 2026-02-04
updated: 2026-02-04
---

## Overview

Write comprehensive unit tests for all @czo/kit components to achieve 80%+ code coverage.

## Parent Epic

- Epic #20: @czo/kit Module

## Source Documents

- **TRD**: docs/planning/kit/trd.md (Section 5 Testing Strategy)

## Technical Details

### Test Coverage Requirements

| Component | Target Coverage |
|-----------|----------------|
| createQueries | 90% |
| createCachedQueries | 85% |
| createMutations | 90% |
| useCacheManager | 85% |
| EventEmitter | 85% |
| HookRegistry | 85% |
| AppRegistry | 80% |
| WebhookDispatcher | 80% |

### Test Structure

```
packages/kit/src/
├── db/repository/
│   ├── queries.test.ts
│   ├── cached-queries.test.ts
│   └── mutations.test.ts
├── cache/
│   └── cache-manager.test.ts
├── events/
│   └── event-emitter.test.ts
├── hooks/
│   └── hook-registry.test.ts
└── apps/
    ├── registry.test.ts
    └── webhooks.test.ts
```

### Test Categories

#### Repository Tests
- [ ] findById returns entity or null
- [ ] findMany with pagination
- [ ] cursor-based pagination
- [ ] soft delete filtering
- [ ] optimistic locking (version check)
- [ ] transaction rollback

#### Cache Tests
- [ ] Cache hit/miss scenarios
- [ ] TTL expiration
- [ ] Pattern invalidation
- [ ] getOrSet factory execution

#### Event Tests
- [ ] Sync event emission
- [ ] Async queue fallback
- [ ] Event context population
- [ ] Unsubscribe cleanup

#### Hook Tests
- [ ] Before hook modification
- [ ] After hook result access
- [ ] Error hook execution
- [ ] Hook ordering

## Acceptance Criteria

- [ ] All components have test files
- [ ] 80%+ overall coverage
- [ ] Tests run in <30s
- [ ] No flaky tests
- [ ] Mocks for external dependencies (Redis, BullMQ)

## Dependencies

- Vitest configured
- Test utilities from @czo/kit
