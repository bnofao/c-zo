---
github_number: 45
title: "Standard de Schema des Events de Domaine (DomainEvent)"
status: synced
type: feature
priority: high
epic: 43
prd: kit
assignees: []
labels: [type:feature, priority:high]
created: 2026-02-10
updated: 2026-02-10
---

## Context
From PRD: kit-microservices (Feature 2)
Priority: P0 — Phase 0 : Préparer le Monolithe
Epic: #43

## Description
Convention de nommage et format d'enveloppe standard pour tous les events de domaine. Garantit l'interopérabilité entre services et la traçabilité des events.

## User Story
**As a** développeur
**I want to** un format standard pour les events
**So that** chaque service puisse les désérialiser et les tracer de manière uniforme

## Acceptance Criteria

### Interface `DomainEvent<T>`
- [ ] Implémentation de l'interface :
  ```typescript
  interface DomainEvent<T = unknown> {
    id: string              // Identifiant unique (idempotence)
    type: string            // Routing key (= event type)
    version: number         // Version du schema
    timestamp: string       // ISO 8601
    source: string          // Service émetteur
    correlationId: string   // Tracing distribué
    data: T                 // Payload spécifique
    metadata: {
      shopId?: string       // Multi-tenant
      actorId?: string      // User ou app
      actorType?: 'user' | 'app' | 'system'
    }
  }
  ```

### Convention de routing key
- [ ] Format : `<domaine>.<entité>.<action>`
- [ ] Exemples : `product.item.created`, `order.checkout.completed`, `auth.user.registered`

### Fonction factory
- [ ] `createDomainEvent(type, data, metadata)` génère automatiquement `id`, `timestamp`, et `correlationId`
- [ ] Propagation du `correlationId` depuis le contexte si disponible

### Type safety
- [ ] Module augmentation via `EventMap` :
  ```typescript
  declare module '@czo/kit' {
    interface EventMap {
      'product.item.created': ProductCreatedPayload
    }
  }
  ```

### Validation
- [ ] Schema Zod pour valider les events entrants

### Migration
- [ ] Guide de migration depuis les event names actuels (ex: `product:created` → `product.item.created`)

## Dependencies
- Zod (existant dans le projet)

## Related
- PRD: docs/planning/kit/prd-microservices.md
- TRD: docs/planning/kit/trd-microservices.md
- Epic: #43
