---
github_number: 38
title: "Configure Redis storage in nitro.config.ts"
status: synced
type: task
priority: medium
epic: 20
prd: kit
assignees: []
labels: []
created: 2026-02-04
updated: 2026-02-08
---

## Overview

Configure Nitro's storage layer to use Redis in production for cache and session storage.

## Parent Epic

- Epic #20: @czo/kit Module

## Source Documents

- **TRD**: docs/planning/kit/trd.md (Section 4.2 Configuration)

## Technical Details

### Nitro Configuration

```typescript
// apps/mazo/nitro.config.ts
export default defineNitroConfig({
  storage: {
    cache: {
      driver: process.env.REDIS_URL ? 'redis' : 'memory',
      url: process.env.REDIS_URL,
      ttl: 300, // 5 minutes default
    },
    session: {
      driver: process.env.REDIS_URL ? 'redis' : 'memory',
      url: process.env.REDIS_URL,
      ttl: 86400, // 24 hours
    },
  },
  
  // Enable Nitro cache for defineCachedFunction
  cache: {
    default: {
      maxAge: 300,
      swr: true,
      staleMaxAge: 3600,
    },
  },
})
```

### Environment Variables

```env
# Production
REDIS_URL=redis://user:password@host:6379/0

# Development (uses memory driver)
# REDIS_URL not set
```

### Redis Driver Setup

If not already available, install the Redis driver:
```bash
pnpm add unstorage-redis-driver
```

## Acceptance Criteria

- [ ] Storage configured with Redis driver for production
- [ ] Memory driver fallback for development
- [ ] Cache namespace properly configured
- [ ] Session storage configured
- [ ] Environment variable documentation updated
- [ ] Works with existing Nitro setup

## Dependencies

- Redis infrastructure (docker-compose for dev)
- unstorage-redis-driver package
